<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grand-Family - Â±±Áî∞ÂÆ∂ Ë¶™ÊóèÂêçÁ∞ø</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="/src/styles.css" rel="stylesheet">
</head>

<body x-data="mainApp" x-init="init()">

  <!-- ======================================== -->
  <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ÔºàÊú™Ë™çË®ºÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
  <!-- ======================================== -->
  <div x-show="!isAuthenticated" x-cloak class="login-screen">
    <div class="login-card">
      <div class="login-header">
        <img src="/Á´π„ÅÆÁÑ°ÊñôÁ¥†Êùê2.svg" alt="Á´π" class="login-icon">
        <h1 class="login-title">„Éá„Ç∏„Çø„É´„Åæ„Åî„Åæ„Åî‰ºöÂêçÁ∞ø</h1>
      </div>

      <form @submit.prevent="onLoginSuccess()" class="login-form">
        <div class="login-input-group">
          <label class="login-label" for="loginId">
            <i class="bi bi-person"></i> ID
          </label>
          <input type="text" id="loginId" class="login-input" x-model="loginId" placeholder="ID„ÇíÂÖ•Âäõ"
            autocomplete="username">
        </div>

        <div class="login-input-group">
          <label class="login-label" for="loginPassword">
            <i class="bi bi-calendar3"></i> ÁîüÂπ¥ÊúàÊó•
          </label>
          <div class="password-input-wrapper">
            <input :type="showPassword ? 'text' : 'password'" id="loginPassword" class="login-input"
              x-model="loginPassword" placeholder="8Ê°ÅÔºà‰æã: 19560423Ôºâ" inputmode="numeric" maxlength="8"
              autocomplete="current-password"
              @input="loginPassword = loginPassword.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/[^0-9]/g, '')">
            <button type="button" class="password-toggle-btn" @click="showPassword = !showPassword" tabindex="-1">
              <i class="bi" :class="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
            </button>
          </div>
        </div>

        <div x-show="loginError" x-cloak class="login-error">
          <i class="bi bi-exclamation-circle"></i>
          <span x-text="loginError"></span>
        </div>

        <button type="submit" class="login-btn" :disabled="isLoggingIn">
          <span x-show="!isLoggingIn">
            <i class="bi bi-box-arrow-in-right"></i> „É≠„Ç∞„Ç§„É≥
          </span>
          <span x-show="isLoggingIn">
            <i class="bi bi-hourglass-split"></i> Á¢∫Ë™ç‰∏≠...
          </span>
        </button>
      </form>

      <div class="login-footer">
        <small>ÁîüÂπ¥ÊúàÊó•„ÅØÂêçÁ∞ø„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„ÇãÊñπ„ÅÆ„ÅøÊúâÂäπ„Åß„Åô</small>
      </div>
    </div>
  </div>

  <!-- ======================================== -->
  <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºàË™çË®ºÂæå„ÅÆ„ÅøË°®Á§∫Ôºâ -->
  <!-- ======================================== -->
  <div x-show="isAuthenticated" x-cloak>

    <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„Éº -->
    <nav class="navbar">
      <div class="container">
        <a class="navbar-brand" href="#">
          <img src="/Á´π„ÅÆÁÑ°ÊñôÁ¥†Êùê2.svg" alt="Á´π" class="navbar-icon"> „Éá„Ç∏„Çø„É´„Åæ„Åî„Åæ„Åî‰ºö
        </a>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#addMemberModal">
            <i class="bi bi-plus-lg"></i> Êñ∞Ë¶èÁôªÈå≤
          </button>
          <button class="btn btn-outline-secondary btn-sm" @click="logout()">
            <i class="bi bi-box-arrow-right"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="container mt-4">
      <!-- „Çπ„ÉÜ„Ç£„ÉÉ„Ç≠„Éº„Éª„Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ôºà„Éî„É´„Çπ„Çø„Ç§„É´Ôºâ -->
      <div class="sticky-nav-container">
        <ul class="nav nav-pills-custom justify-content-center mb-3" role="tablist">
          <li class="nav-item">
            <button class="nav-pill" :class="{ active: currentView === 'magomago' }" @click="currentView = 'magomago'">
              <i class="bi bi-people"></i> „Åæ„Åî„Åæ„Åî‰ºö
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-pill" :class="{ active: currentView === 'tengoku' }" @click="currentView = 'tengoku'">
              <i class="bi bi-cloud"></i> Â§©ÂõΩ‰ºö
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-pill" :class="{ active: currentView === 'tree' }" @click="currentView = 'tree'">
              <i class="bi bi-diagram-3"></i> ÂÆ∂Á≥ªÂõ≥
            </button>
          </li>
        </ul>
      </div>

      <!-- „Åæ„Åî„Åæ„Åî‰ºöÂêçÁ∞øÔºàÂÖ®Âì°Ôºâ -->
      <div x-show="currentView === 'magomago'" x-data="{ isSearchExpanded: false }">

        <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éª„Éè„ÉñÔºöÊûùÁï™„Éï„Ç£„É´„Çø + Ê§úÁ¥¢ -->
        <div class="control-hub d-flex align-items-center mb-4">

          <!-- Â∑¶ÔºöÊûùÁï™„Éï„Ç£„É´„Çø„ÉºÔºàÊ®™„Çπ„ÇØ„É≠„Éº„É´„ÉÅ„ÉÉ„Éó„ÇπÔºâ -->
          <div class="branch-chips-container flex-grow-1 overflow-auto">
            <div class="branch-chips d-flex gap-2 py-2">
              <button class="branch-chip" :class="selectedBranchId === null ? 'active' : ''"
                @click="selectedBranchId = null">
                <i class="bi bi-check2" x-show="selectedBranchId === null"></i>
                ÂÖ®„Å¶
              </button>
              <template x-for="i in 9" :key="i">
                <button class="branch-chip" :class="selectedBranchId === i ? 'active' : ''"
                  @click="selectedBranchId = i">
                  <i class="bi bi-check2" x-show="selectedBranchId === i"></i>
                  <span x-text="branchLabels[i]"></span>
                </button>
              </template>
            </div>
          </div>

          <!-- Âè≥ÔºöÊ§úÁ¥¢„Éà„É™„Ç¨„Éº -->
          <div class="ms-3 flex-shrink-0">
            <button type="button" class="search-toggle-btn"
              @click="isSearchExpanded = !isSearchExpanded; if(isSearchExpanded) $nextTick(() => $refs.searchInput.focus()); else searchQuery = '';">
              <i class="bi" :class="isSearchExpanded ? 'bi-x-lg' : 'bi-search'"></i>
            </button>
          </div>
        </div>

        <!-- Â±ïÈñãÂºèÊ§úÁ¥¢„Éê„Éº -->
        <div class="search-bar-container mb-4" :class="isSearchExpanded ? 'expanded' : ''">
          <div class="search-bar-inner">
            <i class="bi bi-search text-muted"></i>
            <input type="text" class="search-input" placeholder="ÂêçÂâç„ÅßÊ§úÁ¥¢..." x-model="searchQuery" x-ref="searchInput"
              @keydown.escape="isSearchExpanded = false; searchQuery = '';">
            <!-- „ÇØ„É™„Ç¢„Éú„Çø„É≥ -->
            <button type="button" class="search-clear-btn" x-show="searchQuery.length > 0"
              @click="searchQuery = ''; $refs.searchInput.focus();">
              <i class="bi bi-x-circle-fill"></i>
            </button>
          </div>
        </div>

        <!-- ÈÅ∏Êäû‰∏≠„ÅÆÊûùÁï™„ÅÆ„É°„É≥„Éê„Éº„É™„Çπ„Éà -->
        <template
          x-for="branch in membersByBranch.filter(b => selectedBranchId === null || b.branchId === selectedBranchId)"
          :key="branch.branchId">
          <div class="card branch-card mb-4">
            <!-- ÊûùÁï™„Éò„ÉÉ„ÉÄ„ÉºÔºà„Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„ÉºÔºâ -->
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-signpost-split text-primary"></i>
                <span x-text="branch.branchName"></span>
              </h5>
              <span class="badge bg-primary" x-text="`${branch.members.length}Âêç`"></span>
            </div>

            <!-- „É°„É≥„Éê„Éº„É™„Çπ„ÉàÔºà„Ç´„Éº„Éâ„Éú„Éá„Ç£Ôºâ -->
            <div class="list-group list-group-flush">
              <template x-for="member in branch.members" :key="member.id">
                <div class="list-group-item list-group-item-action"
                  :class="{ 'bg-light': member.registry === 'tengoku' }" style="cursor: pointer;"
                  @click="openViewMember(member)">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <!-- ÂêçÂâç„Å®Â§©ÂõΩ‰ºöÂì°„Éê„ÉÉ„Ç∏ -->
                      <div class="d-flex align-items-center gap-2 mb-1">
                        <strong x-text="`${member.lastName} ${member.firstName}`"></strong>
                        <span class="badge ms-1" x-show="member.registry === 'tengoku'"
                          style="background-color: #4a5d23; color: white;">
                          <i class="bi bi-cloud"></i> Â§©ÂõΩ‰ºöÂì°
                        </span>
                      </div>
                      <!-- Ë©≥Á¥∞ÊÉÖÂ†± -->
                      <div class="small text-muted">
                        <span x-text="`Á¨¨${member.generation}‰∏ñ‰ª£`"></span>
                        <template x-if="member.birthDate">
                          <span>
                            ÔΩú <i class="bi bi-cake2"></i>
                            <span x-text="member.birthDate"></span>
                            (<span
                              x-text="calculateAge(member.birthDate, member.registry === 'tengoku' ? member.passedAt : null)"></span>Ê≠≥<span
                              x-show="member.registry === 'tengoku'">„ÅßÊ∞∏Áú†</span>)
                          </span>
                        </template>
                      </div>
                      <div class="small text-muted mt-1" x-show="member.phone || member.address">
                        <template x-if="member.phone">
                          <span>
                            <i class="bi bi-telephone"></i>
                            <a :href="`tel:${member.phone}`" class="text-decoration-none" @click.stop
                              x-text="member.phone"></a>
                          </span>
                        </template>
                        <template x-if="member.address">
                          <span :class="{ 'ms-2': member.phone }">
                            <i class="bi bi-geo-alt"></i>
                            <span x-text="member.address"></span>
                          </span>
                        </template>
                      </div>
                    </div>
                    <button class="btn btn-outline-secondary btn-sm" @click.stop="openEditMember(member)">
                      <i class="bi bi-pencil"></i>
                    </button>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </template>

        <div class="text-center text-muted py-4" x-show="membersByBranch.length === 0">
          „É°„É≥„Éê„Éº„Åå„ÅÑ„Åæ„Åõ„Çì
        </div>
      </div>

      <!-- Â§©ÂõΩ‰ºöÂêçÁ∞øÔºàÊïÖ‰∫∫Ôºâ -->
      <div x-show="currentView === 'tengoku'"
        x-data="{ isSearchExpanded: false, tengokuSearchQuery: '', selectedTengokuBranchId: null }">

        <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éª„Éè„ÉñÔºöÊûùÁï™„Éï„Ç£„É´„Çø + Ê§úÁ¥¢ -->
        <div class="control-hub d-flex align-items-center mb-4">

          <!-- Â∑¶ÔºöÊûùÁï™„Éï„Ç£„É´„Çø„ÉºÔºàÊ®™„Çπ„ÇØ„É≠„Éº„É´„ÉÅ„ÉÉ„Éó„ÇπÔºâ -->
          <div class="branch-chips-container flex-grow-1 overflow-auto">
            <div class="branch-chips d-flex gap-2 py-2">
              <button class="branch-chip" :class="selectedTengokuBranchId === null ? 'active' : ''"
                @click="selectedTengokuBranchId = null">
                <i class="bi bi-check2" x-show="selectedTengokuBranchId === null"></i>
                ÂÖ®„Å¶
              </button>
              <template x-for="i in 9" :key="i">
                <button class="branch-chip" :class="selectedTengokuBranchId === i ? 'active' : ''"
                  @click="selectedTengokuBranchId = i">
                  <i class="bi bi-check2" x-show="selectedTengokuBranchId === i"></i>
                  <span x-text="branchLabels[i]"></span>
                </button>
              </template>
            </div>
          </div>

          <!-- Âè≥ÔºöÊ§úÁ¥¢„Éà„É™„Ç¨„Éº -->
          <div class="ms-3 flex-shrink-0">
            <button type="button" class="search-toggle-btn"
              @click="isSearchExpanded = !isSearchExpanded; if(isSearchExpanded) $nextTick(() => $refs.tengokuSearchInput.focus()); else tengokuSearchQuery = '';">
              <i class="bi" :class="isSearchExpanded ? 'bi-x-lg' : 'bi-search'"></i>
            </button>
          </div>
        </div>

        <!-- Â±ïÈñãÂºèÊ§úÁ¥¢„Éê„Éº -->
        <div class="search-bar-container mb-4" :class="isSearchExpanded ? 'expanded' : ''">
          <div class="search-bar-inner">
            <i class="bi bi-search text-muted"></i>
            <input type="text" class="search-input" placeholder="ÂêçÂâç„ÅßÊ§úÁ¥¢..." x-model="tengokuSearchQuery"
              x-ref="tengokuSearchInput" @keydown.escape="isSearchExpanded = false; tengokuSearchQuery = '';">
            <!-- „ÇØ„É™„Ç¢„Éú„Çø„É≥ -->
            <button type="button" class="search-clear-btn" x-show="tengokuSearchQuery.length > 0"
              @click="tengokuSearchQuery = ''; $refs.tengokuSearchInput.focus();">
              <i class="bi bi-x-circle-fill"></i>
            </button>
          </div>
        </div>

        <!-- ÊûùÁï™„Åî„Å®„ÅÆ„Ç´„Éº„Éâ -->
        <template
          x-for="branchId in [null, 1, 2, 3, 4, 5, 6, 7, 8, 9].filter(id => selectedTengokuBranchId === null || selectedTengokuBranchId === id)"
          :key="branchId ?? 'all'">
          <template
            x-if="tengokuMembers.filter(m => (branchId === null || m.branchId === branchId) && (tengokuSearchQuery === '' || `${m.lastName}${m.firstName}`.toLowerCase().includes(tengokuSearchQuery.toLowerCase()))).length > 0">
            <div class="card branch-card mb-4" x-show="branchId !== null">
              <!-- ÊûùÁï™„Éò„ÉÉ„ÉÄ„Éº -->
              <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="bi bi-signpost-split text-primary"></i>
                  <span x-text="branchLabels[branchId] || 'ÂßãÁ•ñ'"></span>
                </h5>
                <span class="badge bg-primary"
                  x-text="`${tengokuMembers.filter(m => m.branchId === branchId && (tengokuSearchQuery === '' || `${m.lastName}${m.firstName}`.toLowerCase().includes(tengokuSearchQuery.toLowerCase()))).length}Âêç`"></span>
              </div>

              <!-- „É°„É≥„Éê„Éº„É™„Çπ„Éà -->
              <div class="list-group list-group-flush">
                <template
                  x-for="member in tengokuMembers.filter(m => m.branchId === branchId && (tengokuSearchQuery === '' || `${m.lastName}${m.firstName}`.toLowerCase().includes(tengokuSearchQuery.toLowerCase())))"
                  :key="member.id">
                  <div class="list-group-item list-group-item-action bg-light" style="cursor: pointer;"
                    @click="openViewMember(member)">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <!-- ÂêçÂâç -->
                        <div class="d-flex align-items-center gap-2 mb-1">
                          <strong x-text="`${member.lastName} ${member.firstName}`"></strong>
                        </div>
                        <!-- Ë©≥Á¥∞ÊÉÖÂ†± -->
                        <div class="small text-muted">
                          <span x-text="`Á¨¨${member.generation}‰∏ñ‰ª£`"></span>
                          <template x-if="member.passedAt">
                            <span>
                              ÔΩú <i class="bi bi-cloud"></i>
                              <span x-text="member.passedAt"></span>
                              (‰∫´Âπ¥<span x-text="calculateAge(member.birthDate, member.passedAt)"></span>Ê≠≥)
                            </span>
                          </template>
                        </div>
                      </div>
                      <button class="btn btn-outline-secondary btn-sm" @click.stop="openEditMember(member)">
                        <i class="bi bi-pencil"></i>
                      </button>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </template>
        </template>

        <div class="text-center text-muted py-4" x-show="tengokuMembers.length === 0">
          „É°„É≥„Éê„Éº„Åå„ÅÑ„Åæ„Åõ„Çì
        </div>
      </div>

      <div x-show="currentView === 'tree'" x-init="$watch('currentView', v => { if (v === 'tree') initTree(); })"
        class="position-relative">

        <!-- ÂÆ∂Á≥ªÂõ≥„Ç≥„É≥„ÉÜ„Éä -->
        <div id="family-tree-container" class="family-tree-washi rounded" style="min-height: 500px; overflow: hidden;">
        </div>

        <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éª„Éâ„ÉÉ„ÇØÔºàÂè≥‰∏ã„Éï„É≠„Éº„ÉàÔºâ -->
        <div class="control-dock">
          <button class="control-dock-btn" @click="resetZoom()" title="ÂßãÁ•ñ„Å∏Êàª„Çã">
            <i class="bi bi-house-door"></i>
          </button>
          <button class="control-dock-btn" @click="fitToView()" title="ÂÖ®‰Ωì„ÇíË°®Á§∫">
            <i class="bi bi-arrows-fullscreen"></i>
          </button>
          <div class="control-dock-divider"></div>
          <button class="control-dock-btn" @click="zoomIn()" title="Êã°Â§ß">
            <i class="bi bi-plus-lg"></i>
          </button>
          <button class="control-dock-btn" @click="zoomOut()" title="Á∏ÆÂ∞è">
            <i class="bi bi-dash-lg"></i>
          </button>
          <div class="control-dock-divider"></div>
          <button class="control-dock-btn" @click="toggleExpandAll()" title="ÂÖ®„Å¶Â±ïÈñã/Êäò„Çä„Åü„Åü„Åø">
            <i class="bi bi-diagram-2"></i>
          </button>
        </div>

        <!-- „Éê„Éº„Ç∏„Éß„É≥ÊÉÖÂ†± -->
        <div class="text-center text-muted mt-3" style="font-size: 0.75rem; opacity: 0.6;">
          <span id="appVersionDisplay"></span>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- Êñ∞Ë¶è„É°„É≥„Éê„ÉºÁôªÈå≤„É¢„Éº„ÉÄ„É´ -->
    <!-- ======================================== -->
    <div class="modal fade" id="addMemberModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content"
          style="border: none; border-radius: 16px; overflow: hidden; background: linear-gradient(135deg, #FDFBF7 0%, #F5F3EF 100%);">

          <!-- „Éò„ÉÉ„ÉÄ„ÉºÔºàÂíå„É¢„ÉÄ„É≥Ôºâ -->
          <div class="modal-header border-0 pb-2" style="background: transparent;">
            <div class="w-100 text-center pt-2">
              <div
                style="font-family: 'Noto Serif JP', serif; font-size: 1.5rem; font-weight: 500; color: #2F353B; letter-spacing: 0.1em;">
                Êñ∞Ë¶è„É°„É≥„Éê„ÉºÁôªÈå≤
              </div>
            </div>
            <button type="button" class="btn-close position-absolute" data-bs-dismiss="modal"
              style="top: 16px; right: 16px; opacity: 0.5;"></button>
          </div>

          <!-- Âå∫Âàá„ÇäÁ∑öÔºàÂ¢®Á∑öÈ¢®Ôºâ -->
          <div
            style="height: 2px; background: linear-gradient(to right, transparent, #2F353B, transparent); opacity: 0.2; margin: 0 40px 16px;">
          </div>

          <div class="modal-body pt-0" style="padding: 0 24px 16px;">

            <!-- Ë¶™ÈÅ∏Êäû („Ç§„É≥„ÇØ„É™„É°„É≥„Çø„É´Ê§úÁ¥¢) -->
            <div style="background: white; border-radius: 12px; border: 1px solid #e0ddd8; margin-bottom: 20px;">
              <div style="padding: 12px 16px; border-bottom: 1px solid #e0ddd8;">
                <span style="font-family: 'Noto Serif JP', serif; color: #2F353B; font-size: 0.95rem;">
                  <i class="bi bi-arrow-up-circle" style="color: #2D4A6F;"></i> Ë¶™ÔºàÁà∂„Åæ„Åü„ÅØÊØçÔºâ„ÅÆÈÅ∏Êäû <span
                    class="text-danger">*</span>
                </span>
              </div>
              <div style="padding: 16px;">
                <!-- ÈÅ∏ÊäûÊ∏à„ÅøË°®Á§∫Ôºà„ÇØ„É™„ÉÉ„ÇØ„ÅßËß£Èô§Ôºâ -->
                <div x-show="newMember.parentId"
                  style="padding: 12px 16px; background: rgba(45, 74, 111, 0.1); border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;"
                  @click="clearParentSelection()">
                  <i class="bi bi-check-circle" style="color: #2D4A6F;"></i>
                  <strong x-text="getParentDisplayName(newMember.parentId)"></strong>
                  <small style="color: #999; margin-left: auto;">(„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ§âÊõ¥)</small>
                </div>

                <!-- Ê§úÁ¥¢ÂÖ•Âäõ -->
                <div x-show="!newMember.parentId" style="position: relative;">
                  <i class="bi bi-search"
                    style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #999;"></i>
                  <input type="text" x-model="parentSearchQuery" placeholder="ÂêçÂâç„ÅßÊ§úÁ¥¢..."
                    @focus="showParentDropdown = true"
                    style="width: 100%; padding: 14px 14px 14px 42px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                </div>

                <!-- ÂÄôË£ú„É™„Çπ„Éà -->
                <div x-show="!newMember.parentId && parentSearchQuery.length > 0"
                  style="margin-top: 8px; max-height: 200px; overflow-y: auto; border: 1px solid #e0ddd8; border-radius: 8px;">
                  <template x-for="member in filteredParentCandidates" :key="member.id">
                    <button type="button"
                      style="width: 100%; padding: 12px 16px; border: none; background: white; text-align: left; border-bottom: 1px solid #f0ede8; cursor: pointer;"
                      @click="selectParent(member)" onmouseover="this.style.background='#f5f3ef'"
                      onmouseout="this.style.background='white'">
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span x-text="`${member.lastName} ${member.firstName}`"></span>
                        <small style="color: #999;"
                          x-text="`Á¨¨${member.generation}‰∏ñ‰ª£ - ${branchLabels[member.branchId] || 'ÂßãÁ•ñ'}`"></small>
                      </div>
                    </button>
                  </template>
                  <div style="padding: 12px; text-align: center; color: #999;"
                    x-show="filteredParentCandidates.length === 0">
                    ÂÄôË£ú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
                  </div>
                </div>

                <!-- ÂÖ®Âì°Ë°®Á§∫ÔºàÊ§úÁ¥¢„ÇØ„Ç®„É™„ÅåÁ©∫„ÅÆÂ†¥ÂêàÔºâ-->
                <div style="margin-top: 8px;" x-show="!newMember.parentId && parentSearchQuery.length === 0">
                  <small style="color: #999;">
                    <i class="bi bi-info-circle"></i> ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶Ë¶™„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÁôªÈå≤‰∫∫Êï∞: <span x-text="allMembers.length"></span>ÂêçÔºâ
                  </small>
                </div>
              </div>
            </div>

            <!-- Ëá™ÂãïË®àÁÆó„Éï„Ç£„Éº„É´„ÉâË°®Á§∫ -->
            <div x-show="newMember.parentId" x-transition
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
              <div>
                <label style="font-size: 0.8rem; color: #999; display: block; margin-bottom: 4px;">
                  <i class="bi bi-layers"></i> ‰∏ñ‰ª£
                </label>
                <div
                  style="padding: 12px 16px; background: #f5f3ef; border-radius: 8px; font-family: 'Noto Serif JP', serif; color: #2F353B;"
                  x-text="`Á¨¨${newMember.generation}‰∏ñ‰ª£`"></div>
              </div>
              <div>
                <label style="font-size: 0.8rem; color: #999; display: block; margin-bottom: 4px;">
                  <i class="bi bi-signpost-split"></i> ÊûùÁï™
                </label>
                <!-- ÂßãÁ•ñ„ÅåË¶™‰ª•Â§ñ„ÅÆÂ†¥Âêà: Ë™≠„ÅøÂèñ„ÇäÂ∞ÇÁî® -->
                <div x-show="selectedParentGeneration > 1"
                  style="padding: 12px 16px; background: #f5f3ef; border-radius: 8px; font-family: 'Noto Serif JP', serif; color: #2F353B;"
                  x-text="branchLabels[newMember.branchId] || ''"></div>
                <!-- ÂßãÁ•ñ„ÅåË¶™„ÅÆÂ†¥Âêà: ÊûùÁï™„ÇíÊâãÂãïÈÅ∏Êäû -->
                <select x-model.number="newMember.branchId" x-show="selectedParentGeneration === 1"
                  style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;"
                  :style="selectedParentGeneration === 1 && !newMember.branchId ? 'border-color: #c0392b;' : ''">
                  <option value="">ÊûùÁï™„ÇíÈÅ∏Êäû *</option>
                  <template x-for="i in 9" :key="i">
                    <option :value="i" x-text="branchLabels[i]"></option>
                  </template>
                </select>
                <small x-show="selectedParentGeneration === 1 && !newMember.branchId"
                  style="color: #c0392b; font-size: 0.75rem;">
                  <i class="bi bi-exclamation-triangle"></i> ÊûùÁï™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </small>
              </div>
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div style="height: 1px; background: #e0ddd8; margin: 0 0 20px;"></div>

            <!-- Âü∫Êú¨ÊÉÖÂ†± -->
            <div style="font-family: 'Noto Serif JP', serif; font-size: 0.95rem; color: #2F353B; margin-bottom: 16px;">
              <i class="bi bi-person" style="color: #4a5d23;"></i> Âü∫Êú¨ÊÉÖÂ†±
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
              <div>
                <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">
                  Âßì <span style="color: #c0392b;">*</span>
                </label>
                <input type="text" x-model="newMember.lastName" placeholder="Â±±Áî∞"
                  style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
              </div>
              <div>
                <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">
                  Âêç <span style="color: #c0392b;">*</span>
                </label>
                <input type="text" x-model="newMember.firstName" placeholder="Â§™ÈÉé"
                  style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
              </div>
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÁîüÂπ¥ÊúàÊó•</label>
              <input type="text" x-model="newMember.birthDate" placeholder="19900101" inputmode="numeric"
                @blur="newMember.birthDate = formatDateInput(newMember.birthDate)"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 8px;">ÁôªÈå≤Âå∫ÂàÜ</label>
              <div style="display: flex; gap: 12px;">
                <label @click="newMember.registry = 'magomago'"
                  style="flex: 1; padding: 12px 16px; border-radius: 8px; cursor: pointer; text-align: center;" :style="newMember.registry === 'magomago' 
                    ? { background: '#4a5d23', color: 'white', border: '1px solid #4a5d23' } 
                    : { background: 'white', color: '#666', border: '1px solid #e0ddd8' }">
                  <i class="bi bi-emoji-smile"></i> „Åæ„Åî„Åæ„Åî‰ºö
                </label>
                <label @click="newMember.registry = 'tengoku'"
                  style="flex: 1; padding: 12px 16px; border-radius: 8px; cursor: pointer; text-align: center;" :style="newMember.registry === 'tengoku' 
                    ? { background: '#8B8B8B', color: 'white', border: '1px solid #8B8B8B' } 
                    : { background: 'white', color: '#666', border: '1px solid #e0ddd8' }">
                  üïäÔ∏è Â§©ÂõΩ‰ºö
                </label>
              </div>
            </div>

            <div x-show="newMember.registry === 'tengoku'" x-transition style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÂÖ•‰ºöÊó•ÔºàÊ∞∏Áú†Êó•Ôºâ</label>
              <input type="text" x-model="newMember.passedAt" placeholder="20200101" inputmode="numeric"
                @blur="newMember.passedAt = formatDateInput(newMember.passedAt)"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div style="height: 1px; background: #e0ddd8; margin: 0 0 20px;"></div>

            <!-- ÈÖçÂÅ∂ËÄÖÂêåÊôÇÁôªÈå≤ -->
            <div style="background: white; border-radius: 12px; border: 1px solid #e0ddd8; margin-bottom: 20px;"
              :style="addSpouseTogether ? 'border-color: #c0392b;' : ''">
              <div
                style="padding: 12px 16px; border-bottom: 1px solid #e0ddd8; cursor: pointer; display: flex; align-items: center; gap: 12px;"
                @click="addSpouseTogether = !addSpouseTogether">
                <input type="checkbox" x-model="addSpouseTogether" @click.stop
                  style="width: 18px; height: 18px; accent-color: #c0392b;">
                <span style="color: #c0392b;">‚ô•</span>
                <span style="font-family: 'Noto Serif JP', serif; color: #2F353B;">ÈÖçÂÅ∂ËÄÖ„ÇÇ‰∏ÄÁ∑í„Å´ÁôªÈå≤„Åô„Çã</span>
              </div>
              <div x-show="addSpouseTogether" x-transition style="padding: 16px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                  <div>
                    <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÈÖçÂÅ∂ËÄÖ„ÅÆÂßì</label>
                    <input type="text" x-model="newSpouse.lastName" :placeholder="newMember.lastName || 'Â±±Áî∞'"
                      x-init="$watch('newMember.lastName', val => { if (!newSpouse.lastName) newSpouse.lastName = val; })"
                      style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                    <small style="color: #999; font-size: 0.75rem;">Êú¨‰∫∫„ÅÆÂßì„Åã„ÇâËá™Âãï„Ç≥„Éî„Éº</small>
                  </div>
                  <div>
                    <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">
                      ÈÖçÂÅ∂ËÄÖ„ÅÆÂêç <span style="color: #c0392b;">*</span>
                    </label>
                    <input type="text" x-model="newSpouse.firstName" placeholder="Ëä±Â≠ê"
                      style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                  </div>
                </div>
                <div style="margin-bottom: 16px;">
                  <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÁîüÂπ¥ÊúàÊó•</label>
                  <input type="text" x-model="newSpouse.birthDate" placeholder="19900101" inputmode="numeric"
                    @blur="newSpouse.birthDate = formatDateInput(newSpouse.birthDate)"
                    style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                </div>
                <div style="margin-bottom: 16px;">
                  <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 8px;">ÁôªÈå≤Âå∫ÂàÜ</label>
                  <div style="display: flex; gap: 12px;">
                    <label @click="newSpouse.registry = 'magomago'"
                      style="flex: 1; padding: 10px 12px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 0.9rem;"
                      :style="newSpouse.registry === 'magomago' 
                        ? { background: '#4a5d23', color: 'white', border: '1px solid #4a5d23' } 
                        : { background: '#FDFBF7', color: '#666', border: '1px solid #e0ddd8' }">
                      „Åæ„Åî„Åæ„Åî‰ºö
                    </label>
                    <label @click="newSpouse.registry = 'tengoku'"
                      style="flex: 1; padding: 10px 12px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 0.9rem;"
                      :style="newSpouse.registry === 'tengoku' 
                        ? { background: '#8B8B8B', color: 'white', border: '1px solid #8B8B8B' } 
                        : { background: '#FDFBF7', color: '#666', border: '1px solid #e0ddd8' }">
                      üïäÔ∏è Â§©ÂõΩ‰ºö
                    </label>
                  </div>
                </div>
                <div x-show="newSpouse.registry === 'tengoku'" x-transition style="margin-bottom: 16px;">
                  <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÂÖ•‰ºöÊó•ÔºàÊ∞∏Áú†Êó•Ôºâ</label>
                  <input type="text" x-model="newSpouse.passedAt" placeholder="20200101" inputmode="numeric"
                    @blur="newSpouse.passedAt = formatDateInput(newSpouse.passedAt)"
                    style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                </div>
                <div
                  style="padding: 12px; background: rgba(74, 93, 35, 0.08); border-radius: 8px; color: #4a5d23; font-size: 0.85rem;">
                  <i class="bi bi-info-circle"></i>
                  Êú¨‰∫∫„Å®ÈÖçÂÅ∂ËÄÖ„ÅØÁõ∏‰∫í„Å´„É™„É≥„ÇØ„Åï„Çå„ÄÅÂÆ∂Á≥ªÂõ≥„ÅßÊ®™‰∏¶„Å≥„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ
                </div>
              </div>
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div style="height: 1px; background: #e0ddd8; margin: 0 0 20px;"></div>

            <!-- ÈÄ£Áµ°ÂÖàÊÉÖÂ†± -->
            <div style="font-family: 'Noto Serif JP', serif; font-size: 0.95rem; color: #2F353B; margin-bottom: 16px;">
              <i class="bi bi-telephone" style="color: #4a5d23;"></i> ÈÄ£Áµ°ÂÖàÊÉÖÂ†±
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÈõªË©±Áï™Âè∑</label>
              <input type="tel" x-model="newMember.phone" placeholder="090-1234-5678"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">‰ΩèÊâÄ</label>
              <textarea x-model="newMember.address" placeholder="Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫..." rows="2"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7; resize: vertical;"></textarea>
            </div>
          </div>

          <div class="modal-footer border-0 justify-content-center gap-3 pb-4" style="background: transparent;">
            <button type="button" class="btn" data-bs-dismiss="modal"
              style="padding: 12px 28px; border: 1px solid #d0cdc8; background: white; color: #666; border-radius: 24px; font-size: 0.95rem;">
              „Ç≠„É£„É≥„Çª„É´
            </button>
            <button type="button" class="btn" @click="saveMember()" :disabled="!isFormValid"
              style="padding: 12px 28px; background: #4a5d23; color: white; border: none; border-radius: 24px; font-size: 0.95rem;"
              :style="!isFormValid ? 'opacity: 0.5; cursor: not-allowed;' : ''">
              <i class="bi bi-check-lg me-1"></i> ÁôªÈå≤„Åô„Çã
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- „É°„É≥„Éê„ÉºÊÉÖÂ†±Ë°®Á§∫„É¢„Éº„ÉÄ„É´ÔºàÂíå„É¢„ÉÄ„É≥Ôºâ -->
    <!-- ======================================== -->
    <div class="modal fade" id="viewMemberModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" x-show="viewMember"
          style="border: none; border-radius: 16px; overflow: hidden; background: linear-gradient(135deg, #FDFBF7 0%, #F5F3EF 100%);">

          <!-- „Éò„ÉÉ„ÉÄ„ÉºÔºàÂíåÁ¥ôË™øÔºâ -->
          <div class="modal-header border-0 pb-0" style="background: transparent;">
            <button type="button" class="btn-close" data-bs-dismiss="modal" style="opacity: 0.5;"></button>
          </div>

          <div class="modal-body pt-0 px-4">
            <!-- ÂêçÂâçÔºàÊòéÊúù‰Ωì„Éª‰∏≠Â§ÆÔºâ -->
            <div class="text-center mb-4">
              <div
                style="font-family: 'Noto Serif JP', serif; font-size: 1.75rem; font-weight: 500; color: #2F353B; letter-spacing: 0.1em;"
                x-text="`${viewMember?.lastName} ${viewMember?.firstName}`"></div>

              <!-- Â§©ÂõΩ‰ºöÂì°„ÅØÈ≥©„Éû„Éº„ÇØ -->
              <div x-show="viewMember?.registry === 'tengoku'" class="mt-2" style="color: #8B8B8B; font-size: 0.9rem;">
                <span style="font-size: 1.2rem;">üïäÔ∏è</span> Â§©ÂõΩ‰ºöÂì°
              </div>
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑öÔºàÂ¢®Á∑öÈ¢®Ôºâ -->
            <div
              style="height: 2px; background: linear-gradient(to right, transparent, #2F353B, transparent); opacity: 0.3; margin: 0 20px 24px;">
            </div>

            <!-- ÊÉÖÂ†±„Ç∞„É™„ÉÉ„Éâ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">

              <!-- ‰∏ñ‰ª£ -->
              <div class="text-center">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">‰∏ñ‰ª£</div>
                <div style="font-family: 'Noto Serif JP', serif; font-size: 1.1rem; color: #2F353B;"
                  x-text="`Á¨¨${viewMember?.generation}‰∏ñ‰ª£`"></div>
              </div>

              <!-- ÊûùÁï™ -->
              <div class="text-center">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">ÊûùÁï™</div>
                <div style="font-family: 'Noto Serif JP', serif; font-size: 1.1rem; color: #2F353B;"
                  x-text="branchLabels[viewMember?.branchId] || 'ÂßãÁ•ñ'"></div>
              </div>

              <!-- ÁîüÂπ¥ÊúàÊó• -->
              <div class="text-center" x-show="viewMember?.birthDate">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">ÁîüÂπ¥ÊúàÊó•</div>
                <div style="font-family: 'Noto Serif JP', serif; font-size: 1.1rem; color: #2F353B;"
                  x-text="viewMember?.birthDate"></div>
              </div>

              <!-- Âπ¥ÈΩ¢ -->
              <div class="text-center" x-show="viewMember?.birthDate">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;"
                  x-text="viewMember?.registry === 'tengoku' ? '‰∫´Âπ¥' : 'Âπ¥ÈΩ¢'"></div>
                <div style="font-family: 'Noto Serif JP', serif; font-size: 1.1rem; color: #2F353B;">
                  <span
                    x-text="calculateAge(viewMember?.birthDate, viewMember?.registry === 'tengoku' ? viewMember?.passedAt : null)"></span>Ê≠≥
                </div>
              </div>
            </div>

            <!-- Ê∞∏Áú†Êó•ÔºàÂ§©ÂõΩ‰ºöÂì°„ÅÆ„ÅøÔºâ -->
            <div x-show="viewMember?.registry === 'tengoku' && viewMember?.passedAt" class="text-center mb-4"
              style="padding: 12px; background: rgba(139, 139, 139, 0.08); border-radius: 8px;">
              <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">Ê∞∏Áú†Êó•</div>
              <div style="font-family: 'Noto Serif JP', serif; font-size: 1rem; color: #8B8B8B;"
                x-text="viewMember?.passedAt"></div>
            </div>

            <!-- ÈÖçÂÅ∂ËÄÖ -->
            <div x-show="viewMember?.spouseId" class="text-center mb-4">
              <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">
                <span style="color: #c0392b;">‚ô•</span> ÈÖçÂÅ∂ËÄÖ
              </div>
              <div style="font-family: 'Noto Serif JP', serif; font-size: 1rem; color: #2F353B;"
                x-text="getSpouseDisplayName(viewMember?.spouseId)"></div>
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div x-show="viewMember?.phone || viewMember?.address"
              style="height: 1px; background: #e0ddd8; margin: 0 0 20px;"></div>

            <!-- ÈÄ£Áµ°ÂÖàÊÉÖÂ†± -->
            <div x-show="viewMember?.phone || viewMember?.address" style="margin-bottom: 8px;">

              <!-- ÈõªË©±Áï™Âè∑ -->
              <div x-show="viewMember?.phone" class="mb-3">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">ÈõªË©±Áï™Âè∑</div>
                <a :href="`tel:${viewMember?.phone}`"
                  style="font-size: 1rem; color: #2F353B; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e0ddd8;">
                  <i class="bi bi-telephone" style="color: #4a5d23;"></i>
                  <span x-text="viewMember?.phone"></span>
                </a>
              </div>

              <!-- ‰ΩèÊâÄ -->
              <div x-show="viewMember?.address">
                <div style="font-size: 0.75rem; color: #999; margin-bottom: 4px;">‰ΩèÊâÄ</div>
                <div
                  style="font-size: 0.95rem; color: #2F353B; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e0ddd8;">
                  <i class="bi bi-geo-alt" style="color: #c0392b; margin-right: 6px;"></i>
                  <span x-text="viewMember?.address"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- „Éï„ÉÉ„Çø„Éº -->
          <div class="modal-footer border-0 justify-content-center gap-3 pb-4" style="background: transparent;">
            <button type="button" class="btn" data-bs-dismiss="modal"
              style="padding: 10px 24px; border: 1px solid #d0cdc8; background: white; color: #666; border-radius: 24px;">
              Èñâ„Åò„Çã
            </button>
            <button type="button" class="btn" @click="openEditFromView()"
              style="padding: 10px 24px; background: #2F353B; color: white; border: none; border-radius: 24px;">
              <i class="bi bi-pencil me-1"></i> Á∑®ÈõÜ„Åô„Çã
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- „É°„É≥„Éê„ÉºÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ÔºàÂíå„É¢„ÉÄ„É≥Ôºâ -->
    <!-- ======================================== -->
    <div class="modal fade" id="editMemberModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" x-show="editMember"
          style="border: none; border-radius: 16px; overflow: hidden; background: linear-gradient(135deg, #FDFBF7 0%, #F5F3EF 100%);">

          <!-- „Éò„ÉÉ„ÉÄ„Éº -->
          <div class="modal-header border-0 pb-2" style="background: transparent;">
            <div class="w-100 text-center pt-2">
              <div
                style="font-family: 'Noto Serif JP', serif; font-size: 1.5rem; font-weight: 500; color: #2F353B; letter-spacing: 0.1em;">
                „É°„É≥„Éê„ÉºÊÉÖÂ†±Á∑®ÈõÜ
              </div>
            </div>
            <button type="button" class="btn-close position-absolute" @click="cancelEdit()"
              style="top: 16px; right: 16px; opacity: 0.5;"></button>
          </div>

          <!-- Âå∫Âàá„ÇäÁ∑ö -->
          <div
            style="height: 2px; background: linear-gradient(to right, transparent, #2F353B, transparent); opacity: 0.2; margin: 0 40px 16px;">
          </div>

          <div class="modal-body pt-0" style="padding: 0 24px 16px;">

            <!-- Ë™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®ÊÉÖÂ†± -->
            <div style="padding: 12px; background: rgba(45, 74, 111, 0.08); border-radius: 8px; margin-bottom: 20px;">
              <small style="color: #666;">
                <i class="bi bi-info-circle"></i> ‰∏ñ‰ª£„Å®ÊûùÁï™„ÅØÂ§âÊõ¥„Åß„Åç„Åæ„Åõ„Çì
              </small>
              <div style="margin-top: 8px; display: flex; gap: 8px;">
                <span
                  style="padding: 4px 12px; background: #2D4A6F; color: white; border-radius: 12px; font-size: 0.8rem;"
                  x-text="`Á¨¨${editMember?.generation}‰∏ñ‰ª£`"></span>
                <span
                  style="padding: 4px 12px; background: #2D4A6F; color: white; border-radius: 12px; font-size: 0.8rem;"
                  x-text="branchLabels[editMember?.branchId] || 'ÂßãÁ•ñ'"></span>
              </div>
            </div>

            <!-- Âü∫Êú¨ÊÉÖÂ†± -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
              <div>
                <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">Âßì</label>
                <input type="text" x-model="editMember.lastName"
                  style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
              </div>
              <div>
                <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">Âêç</label>
                <input type="text" x-model="editMember.firstName"
                  style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
              </div>
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÁîüÂπ¥ÊúàÊó•</label>
              <input type="text" x-model="editMember.birthDate" placeholder="19900101" inputmode="numeric"
                @blur="editMember.birthDate = formatDateInput(editMember.birthDate)"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 8px;">ÁôªÈå≤Âå∫ÂàÜ</label>
              <div style="display: flex; gap: 12px;">
                <label @click="editMember.registry = 'magomago'"
                  style="flex: 1; padding: 12px 16px; border-radius: 8px; cursor: pointer; text-align: center;" :style="editMember.registry === 'magomago' 
                    ? { background: '#4a5d23', color: 'white', border: '1px solid #4a5d23' } 
                    : { background: 'white', color: '#666', border: '1px solid #e0ddd8' }">
                  <i class="bi bi-emoji-smile"></i> „Åæ„Åî„Åæ„Åî‰ºö
                </label>
                <label @click="editMember.registry = 'tengoku'"
                  style="flex: 1; padding: 12px 16px; border-radius: 8px; cursor: pointer; text-align: center;" :style="editMember.registry === 'tengoku' 
                    ? { background: '#8B8B8B', color: 'white', border: '1px solid #8B8B8B' } 
                    : { background: 'white', color: '#666', border: '1px solid #e0ddd8' }">
                  üïäÔ∏è Â§©ÂõΩ‰ºö
                </label>
              </div>
            </div>

            <div x-show="editMember?.registry === 'tengoku'" x-transition style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÂÖ•‰ºöÊó•ÔºàÊ∞∏Áú†Êó•Ôºâ</label>
              <input type="text" x-model="editMember.passedAt" placeholder="20200101" inputmode="numeric"
                @blur="editMember.passedAt = formatDateInput(editMember.passedAt)"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <!-- ÈÖçÂÅ∂ËÄÖÊÉÖÂ†± -->
            <div style="margin-bottom: 16px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 8px;">
                <span style="color: #c0392b;">‚ô•</span> ÈÖçÂÅ∂ËÄÖ
              </label>

              <!-- ÈÖçÂÅ∂ËÄÖ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà -->
              <div x-show="editMember?.spouseId"
                style="padding: 12px 16px; background: white; border: 1px solid #e0ddd8; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                <span>
                  <span style="color: #c0392b;">‚ô•</span>
                  <strong x-text="getSpouseDisplayName(editMember?.spouseId)"></strong>
                </span>
                <button type="button" @click="unlinkSpouse()"
                  style="padding: 6px 12px; border: 1px solid #d0cdc8; background: white; color: #666; border-radius: 16px; font-size: 0.8rem; cursor: pointer;">
                  „É™„É≥„ÇØËß£Èô§
                </button>
              </div>

              <!-- ÈÖçÂÅ∂ËÄÖ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥ÂêàÔºöÊ§úÁ¥¢Âºè -->
              <div x-show="!editMember?.spouseId">
                <!-- Ê§úÁ¥¢ÂÖ•Âäõ -->
                <div style="position: relative;" x-show="!showNewSpouseForm">
                  <i class="bi bi-search"
                    style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #999;"></i>
                  <input type="text" x-model="spouseSearchQuery" placeholder="ÂêçÂâç„ÅßÈÖçÂÅ∂ËÄÖ„ÇíÊ§úÁ¥¢..."
                    @focus="showSpouseDropdown = true"
                    style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
                </div>

                <!-- ÂÄôË£ú„É™„Çπ„Éà -->
                <div x-show="spouseSearchQuery.length > 0 && !showNewSpouseForm"
                  style="margin-top: 8px; max-height: 150px; overflow-y: auto; border: 1px solid #e0ddd8; border-radius: 8px;">
                  <template x-for="member in filteredSpouseCandidates" :key="member.id">
                    <button type="button" @click="selectSpouse(member)"
                      style="width: 100%; padding: 10px 14px; border: none; background: white; text-align: left; border-bottom: 1px solid #f0ede8; cursor: pointer;"
                      onmouseover="this.style.background='#f5f3ef'" onmouseout="this.style.background='white'">
                      <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span x-text="`${member.lastName} ${member.firstName}`"></span>
                        <small style="color: #999;" x-text="`Á¨¨${member.generation}‰∏ñ‰ª£`"></small>
                      </div>
                    </button>
                  </template>
                  <div style="padding: 10px; text-align: center; color: #999;"
                    x-show="filteredSpouseCandidates.length === 0">
                    ÂÄôË£ú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
                  </div>
                </div>

                <small style="color: #999; margin-top: 6px; display: block;"
                  x-show="spouseSearchQuery.length === 0 && !showNewSpouseForm">
                  <i class="bi bi-info-circle"></i> ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶ÈÖçÂÅ∂ËÄÖ„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </small>

                <!-- ÈÖçÂÅ∂ËÄÖ„ÇíÊñ∞Ë¶èÁôªÈå≤„Éú„Çø„É≥ -->
                <button type="button" @click="toggleNewSpouseForm()" x-show="!showNewSpouseForm"
                  style="margin-top: 12px; width: 100%; padding: 10px 16px; border: 1px dashed #c0392b; background: rgba(192, 57, 43, 0.05); color: #c0392b; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                  <i class="bi bi-plus-circle"></i> ÈÖçÂÅ∂ËÄÖ„ÇíÊñ∞Ë¶èÁôªÈå≤
                </button>

                <!-- ÈÖçÂÅ∂ËÄÖÊñ∞Ë¶èÁôªÈå≤„Éï„Ç©„Éº„É† -->
                <div x-show="showNewSpouseForm" x-transition
                  style="margin-top: 12px; padding: 16px; background: white; border: 1px solid #c0392b; border-radius: 12px;">
                  <div style="font-size: 0.9rem; color: #c0392b; margin-bottom: 12px; font-weight: 500;">
                    <i class="bi bi-heart-fill"></i> ÈÖçÂÅ∂ËÄÖ„ÇíÊñ∞Ë¶èÁôªÈå≤
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div>
                      <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 4px;">Âßì</label>
                      <input type="text" x-model="newSpouseForEdit.lastName" :placeholder="editMember?.lastName || 'Â±±Áî∞'"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #e0ddd8; border-radius: 6px; font-size: 0.95rem; background: #FDFBF7;">
                    </div>
                    <div>
                      <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 4px;">
                        Âêç <span style="color: #c0392b;">*</span>
                      </label>
                      <input type="text" x-model="newSpouseForEdit.firstName" placeholder="Ëä±Â≠ê"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #e0ddd8; border-radius: 6px; font-size: 0.95rem; background: #FDFBF7;">
                    </div>
                  </div>

                  <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 4px;">ÁîüÂπ¥ÊúàÊó•</label>
                    <input type="text" x-model="newSpouseForEdit.birthDate" placeholder="19900101" inputmode="numeric"
                      @blur="newSpouseForEdit.birthDate = formatDateInput(newSpouseForEdit.birthDate)"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #e0ddd8; border-radius: 6px; font-size: 0.95rem; background: #FDFBF7;">
                  </div>

                  <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 6px;">ÁôªÈå≤Âå∫ÂàÜ</label>
                    <div style="display: flex; gap: 8px;">
                      <label @click="newSpouseForEdit.registry = 'magomago'"
                        style="flex: 1; padding: 8px 10px; border-radius: 6px; cursor: pointer; text-align: center; font-size: 0.85rem;"
                        :style="newSpouseForEdit.registry === 'magomago' 
                          ? { background: '#4a5d23', color: 'white', border: '1px solid #4a5d23' } 
                          : { background: '#FDFBF7', color: '#666', border: '1px solid #e0ddd8' }">
                        „Åæ„Åî„Åæ„Åî‰ºö
                      </label>
                      <label @click="newSpouseForEdit.registry = 'tengoku'"
                        style="flex: 1; padding: 8px 10px; border-radius: 6px; cursor: pointer; text-align: center; font-size: 0.85rem;"
                        :style="newSpouseForEdit.registry === 'tengoku' 
                          ? { background: '#8B8B8B', color: 'white', border: '1px solid #8B8B8B' } 
                          : { background: '#FDFBF7', color: '#666', border: '1px solid #e0ddd8' }">
                        üïäÔ∏è Â§©ÂõΩ‰ºö
                      </label>
                    </div>
                  </div>

                  <div x-show="newSpouseForEdit.registry === 'tengoku'" x-transition style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 4px;">ÂÖ•‰ºöÊó•ÔºàÊ∞∏Áú†Êó•Ôºâ</label>
                    <input type="text" x-model="newSpouseForEdit.passedAt" placeholder="20200101" inputmode="numeric"
                      @blur="newSpouseForEdit.passedAt = formatDateInput(newSpouseForEdit.passedAt)"
                      style="width: 100%; padding: 10px 12px; border: 1px solid #e0ddd8; border-radius: 6px; font-size: 0.95rem; background: #FDFBF7;">
                  </div>

                  <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button type="button" @click="showNewSpouseForm = false"
                      style="padding: 8px 16px; border: 1px solid #d0cdc8; background: white; color: #666; border-radius: 20px; font-size: 0.85rem; cursor: pointer;">
                      „Ç≠„É£„É≥„Çª„É´
                    </button>
                    <button type="button" @click="saveNewSpouseFromEdit()"
                      style="padding: 8px 16px; background: #c0392b; color: white; border: none; border-radius: 20px; font-size: 0.85rem; cursor: pointer;">
                      <i class="bi bi-check-lg"></i> ÁôªÈå≤
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Âå∫Âàá„ÇäÁ∑ö -->
            <div style="height: 1px; background: #e0ddd8; margin: 0 0 16px;"></div>

            <!-- ÈÄ£Áµ°ÂÖàÊÉÖÂ†± -->
            <div style="font-family: 'Noto Serif JP', serif; font-size: 0.95rem; color: #2F353B; margin-bottom: 12px;">
              <i class="bi bi-telephone" style="color: #2D4A6F;"></i> ÈÄ£Áµ°ÂÖàÊÉÖÂ†±
            </div>

            <div style="margin-bottom: 12px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">ÈõªË©±Áï™Âè∑</label>
              <input type="tel" x-model="editMember.phone" placeholder="090-1234-5678"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7;">
            </div>

            <div style="margin-bottom: 8px;">
              <label style="font-size: 0.8rem; color: #666; display: block; margin-bottom: 4px;">‰ΩèÊâÄ</label>
              <textarea x-model="editMember.address" placeholder="Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫..." rows="2"
                style="width: 100%; padding: 12px 16px; border: 1px solid #e0ddd8; border-radius: 8px; font-size: 1rem; background: #FDFBF7; resize: vertical;"></textarea>
            </div>
          </div>

          <!-- „Éï„ÉÉ„Çø„Éº -->
          <div class="modal-footer border-0 pb-4"
            style="background: transparent; display: flex; justify-content: space-between; padding: 0 24px;">
            <button type="button" @click="deleteMember()"
              style="padding: 10px 20px; border: 1px solid #c0392b; background: white; color: #c0392b; border-radius: 24px; font-size: 0.9rem; cursor: pointer;">
              <i class="bi bi-trash"></i> ÂâäÈô§
            </button>
            <div style="display: flex; gap: 12px;">
              <button type="button" @click="cancelEdit()"
                style="padding: 10px 24px; border: 1px solid #d0cdc8; background: white; color: #666; border-radius: 24px; font-size: 0.9rem; cursor: pointer;">
                „Ç≠„É£„É≥„Çª„É´
              </button>
              <button type="button" @click="saveEdit()"
                style="padding: 10px 24px; background: #2D4A6F; color: white; border: none; border-radius: 24px; font-size: 0.9rem; cursor: pointer;">
                <i class="bi bi-check-lg me-1"></i> Êõ¥Êñ∞„Åô„Çã
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <!-- ======================================== -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> ÂâäÈô§„ÅÆÁ¢∫Ë™ç</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <i class="bi bi-person-x text-danger" style="font-size: 3rem;"></i>
            </div>
            <p class="text-center mb-3" x-text="deleteConfirmMessage"></p>

            <!-- ÈÖçÂÅ∂ËÄÖÂêåÊôÇÂâäÈô§„Ç™„Éó„Ç∑„Éß„É≥ -->
            <div x-show="deleteSpouseOption" class="alert alert-warning">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="deleteSpouseCheck" x-model="deleteSpouseTogether">
                <label class="form-check-label" for="deleteSpouseCheck">
                  <i class="bi bi-heart-fill text-danger"></i>
                  ÈÖçÂÅ∂ËÄÖ„Äå<span x-text="deleteSpouseName"></span>„Äç„ÇÇ‰∏ÄÁ∑í„Å´ÂâäÈô§„Åô„Çã
                </label>
              </div>
            </div>

            <div class="alert alert-secondary mb-0">
              <small><i class="bi bi-info-circle"></i> „Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-lg"></i> „Ç≠„É£„É≥„Çª„É´
            </button>
            <button type="button" class="btn btn-danger" @click="executeDelete()">
              <i class="bi bi-trash"></i> ÂâäÈô§„Åô„Çã
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- ÊàêÂäüÈÄöÁü•„É¢„Éº„ÉÄ„É´ -->
    <!-- ======================================== -->
    <div class="modal fade" id="successModal" tabindex="-1">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center py-4">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
            <h5 class="mt-3" x-text="successMessage || 'ÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ'"></h5>
          </div>
          <div class="modal-footer justify-content-center border-0 pt-0">
            <button type="button" class="btn btn-success" data-bs-dismiss="modal">
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

  </div> <!-- /isAuthenticated -->

  <!-- ======================================== -->
  <!-- Êõ¥Êñ∞ÈÄöÁü•„Éê„Éä„Éº -->
  <!-- ======================================== -->
  <div id="updateBanner"
    style="display: none; position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 16px; text-align: center; z-index: 9999; cursor: pointer;"
    onclick="applyUpdate()">
    <i class="bi bi-arrow-clockwise me-2"></i>Êñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Çø„ÉÉ„Éó„Åó„Å¶Êõ¥Êñ∞
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App Entry Point -->
  <script type="module" src="/src/main.js"></script>

  <!-- ============================================
       „Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ & Ëá™ÂãïÊõ¥Êñ∞„Çπ„ÇØ„É™„Éó„Éà
       ============================================ -->
  <script>
    // ============================================
    // „Ç¢„Éó„É™„Éê„Éº„Ç∏„Éß„É≥Ôºàversion.json„Å®ÂêåÊúüÔºâ
    // ============================================
    const APP_VERSION = '1.0.4';

    // ============================================
    // Êõ¥Êñ∞„ÇíÈÅ©Áî®„Åô„ÇãÈñ¢Êï∞Ôºà„Éê„Éä„Éº„Çø„ÉÉ„ÉóÊôÇ„Å´Âëº„Å∞„Çå„ÇãÔºâ
    // ============================================
    function applyUpdate() {
      location.reload(true);
    }

    // ============================================
    // Êõ¥Êñ∞„Éê„Éä„Éº„ÇíË°®Á§∫
    // ============================================
    function showUpdateBanner() {
      const banner = document.getElementById('updateBanner');
      if (banner) {
        banner.style.display = 'block';
      }
    }

    // ============================================
    // „Éê„Éº„Ç∏„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØÊ©üËÉΩÔºàÁ¢∫ÂÆü„Å™Ëá™ÂãïÊõ¥Êñ∞Ôºâ
    // ============================================
    async function checkAppVersion() {
      try {
        // „Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁÑ°Âäπ„Å´„Åó„Å¶version.json„ÇíÂèñÂæó
        const response = await fetch('/version.json?t=' + Date.now(), {
          cache: 'no-store',
          headers: { 'Cache-Control': 'no-cache' }
        });

        if (!response.ok) {
          console.log('[Version] version.jsonÂèñÂæóÂ§±Êïó:', response.status);
          return;
        }

        const data = await response.json();
        const serverVersion = data.version;

        console.log('[Version] „Çµ„Éº„Éê„Éº:', serverVersion, '„É≠„Éº„Ç´„É´:', APP_VERSION);

        // „Éê„Éº„Ç∏„Éß„É≥„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÅØËá™Âãï„É™„É≠„Éº„Éâ
        if (serverVersion && serverVersion !== APP_VERSION) {
          console.log('[Version] Êñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„ÇíÊ§úÂá∫ÔºÅËá™ÂãïÊõ¥Êñ∞„Åó„Åæ„Åô...');

          // „Ç≠„É£„ÉÉ„Ç∑„É•„Çí„ÇØ„É™„Ç¢
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
            console.log('[Version] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü');
          }

          // „Éö„Éº„Ç∏„Çí„É™„É≠„Éº„ÉâÔºà„Ç≠„É£„ÉÉ„Ç∑„É•ÁÑ°ÂäπÔºâ
          window.location.reload(true);
        }
      } catch (error) {
        console.log('[Version] „ÉÅ„Çß„ÉÉ„ÇØÂ§±ÊïóÔºà„Ç™„Éï„É©„Ç§„É≥?Ôºâ:', error.message);
      }
    }

    // Ëµ∑ÂãïÊôÇ„Å´„Éê„Éº„Ç∏„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØÔºàÂ∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶UIË°®Á§∫Âæå„Å´ÂÆüË°åÔºâ
    document.addEventListener('DOMContentLoaded', () => {
      // „Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞
      const versionEl = document.getElementById('appVersionDisplay');
      if (versionEl) {
        versionEl.textContent = '„Éê„Éº„Ç∏„Éß„É≥ v' + APP_VERSION;
      }

      setTimeout(checkAppVersion, 1000);
    });
  </script>
</body>

</html>